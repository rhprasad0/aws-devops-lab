apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: guestbook

resources:
  - namespace.yaml
  - serviceaccount.yaml
  - deployment.yaml
  - service.yaml
  - ingress.yaml

# Image will be updated by CI/CD pipeline or manually
images:
  - name: GUESTBOOK_IMAGE
    newName: ACCOUNT_ID.dkr.ecr.us-east-1.amazonaws.com/eks-lab/guestbook
    newTag: latest

# ConfigMap generator for environment-specific values
configMapGenerator:
  - name: guestbook-config
    literals:
      - AWS_REGION=us-east-1
      - DYNAMODB_TABLE_NAME=dev-guestbook-messages
      - API_KEYS_SECRET_NAME=dev-guestbook-api-keys
      - RATE_LIMIT_PER_MINUTE=10
      - LOG_LEVEL=INFO
      - PORT=8000

# Common labels applied to all resources
commonLabels:
  app.kubernetes.io/name: guestbook
  app.kubernetes.io/component: application
  app.kubernetes.io/part-of: eks-lab
